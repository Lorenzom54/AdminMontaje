<!DOCTYPE html><html lang="es" data-astro-cid-2kanml4j> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.10.0"><title>Piezas - Panel de Administración</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style>.sidebar[data-astro-cid-ssfzsv2f]{position:fixed;left:0;top:0;width:280px;height:100vh;background:linear-gradient(180deg,#1f2937,#111827);color:#fff;display:flex;flex-direction:column;z-index:1000;box-shadow:4px 0 24px #0000001a}.sidebar-header[data-astro-cid-ssfzsv2f]{padding:24px;border-bottom:1px solid rgba(255,255,255,.1)}.logo[data-astro-cid-ssfzsv2f]{display:flex;align-items:center;gap:12px}.logo-text[data-astro-cid-ssfzsv2f]{font-size:18px;font-weight:700;color:#fff}.sidebar-nav[data-astro-cid-ssfzsv2f]{flex:1;padding:16px 0;overflow-y:auto}.nav-list[data-astro-cid-ssfzsv2f]{list-style:none}.nav-item[data-astro-cid-ssfzsv2f]{margin-bottom:4px}.nav-link[data-astro-cid-ssfzsv2f]{display:flex;align-items:center;gap:12px;padding:12px 24px;color:#d1d5db;text-decoration:none;transition:all .2s ease;border-left:3px solid transparent}.nav-link[data-astro-cid-ssfzsv2f]:hover{background:#ffffff0d;color:#fff}.nav-link[data-astro-cid-ssfzsv2f].active{background:#3b82f61a;color:#60a5fa;border-left-color:#3b82f6}.nav-icon[data-astro-cid-ssfzsv2f]{display:flex;align-items:center;justify-content:center;width:20px;height:20px}.nav-text[data-astro-cid-ssfzsv2f]{font-weight:500;font-size:14px}.sidebar-footer[data-astro-cid-ssfzsv2f]{padding:24px;border-top:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:space-between}.user-info[data-astro-cid-ssfzsv2f]{display:flex;align-items:center;gap:12px}.user-avatar[data-astro-cid-ssfzsv2f]{width:40px;height:40px;background:#3b82f633;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#60a5fa}.user-details[data-astro-cid-ssfzsv2f]{display:flex;flex-direction:column}.user-name[data-astro-cid-ssfzsv2f]{font-size:14px;font-weight:600;color:#fff}.user-role[data-astro-cid-ssfzsv2f]{font-size:12px;color:#9ca3af}.logout-btn[data-astro-cid-ssfzsv2f]{background:none;border:none;color:#9ca3af;cursor:pointer;padding:8px;border-radius:6px;transition:all .2s ease}.logout-btn[data-astro-cid-ssfzsv2f]:hover{background:#ef44441a;color:#fca5a5}@media (max-width: 1024px){.sidebar[data-astro-cid-ssfzsv2f]{transform:translate(-100%);transition:transform .3s ease}.sidebar[data-astro-cid-ssfzsv2f].open{transform:translate(0)}}[data-astro-cid-2kanml4j]{margin:0;padding:0;box-sizing:border-box}html,body{height:100%;overflow-x:hidden}body{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;background-color:#f8fafc;color:#1f2937;line-height:1.6;position:relative}.admin-layout[data-astro-cid-2kanml4j]{display:flex;min-height:100vh;position:relative}.main-content[data-astro-cid-2kanml4j]{flex:1;margin-left:280px;transition:margin-left .3s ease;position:relative}.content-wrapper[data-astro-cid-2kanml4j]{padding:32px;max-width:1200px;margin:0 auto}.modal{position:fixed!important;top:0!important;left:0!important;width:100vw!important;height:100vh!important;z-index:9999!important}.modal.active{display:flex!important}.modal-backdrop{position:absolute!important;top:0!important;left:0!important;width:100%!important;height:100%!important}.modal-container{position:relative!important;z-index:10000!important}@media (max-width: 1024px){.main-content[data-astro-cid-2kanml4j]{margin-left:0}}@media (max-width: 768px){.content-wrapper[data-astro-cid-2kanml4j]{padding:16px}}
.page-header[data-astro-cid-wu5dj4rx]{margin-bottom:32px;padding-bottom:24px;border-bottom:1px solid #e5e7eb}.header-content[data-astro-cid-wu5dj4rx]{display:flex;align-items:center;justify-content:space-between;gap:24px}.header-text[data-astro-cid-wu5dj4rx]{flex:1}.page-title[data-astro-cid-wu5dj4rx]{font-size:28px;font-weight:700;color:#111827;margin-bottom:4px}.page-subtitle[data-astro-cid-wu5dj4rx]{font-size:16px;color:#6b7280;margin:0}.header-actions[data-astro-cid-wu5dj4rx]{display:flex;gap:12px}.action-button[data-astro-cid-wu5dj4rx]{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:600;text-decoration:none;cursor:pointer;transition:all .2s ease;box-shadow:0 1px 3px #0000001a}.action-button[data-astro-cid-wu5dj4rx]:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}@media (max-width: 768px){.header-content[data-astro-cid-wu5dj4rx]{flex-direction:column;align-items:flex-start}.page-title[data-astro-cid-wu5dj4rx]{font-size:24px}.action-button[data-astro-cid-wu5dj4rx]{width:100%;justify-content:center}}
</style>
<link rel="stylesheet" href="/_astro/chapas.CuxgIUc2.css">
<link rel="stylesheet" href="/_astro/piezas.BRwnFa7i.css"></head> <body data-astro-cid-2kanml4j> <div class="admin-layout" data-astro-cid-2kanml4j> <aside class="sidebar" data-astro-cid-ssfzsv2f> <div class="sidebar-header" data-astro-cid-ssfzsv2f> <div class="logo" data-astro-cid-ssfzsv2f> <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" data-astro-cid-ssfzsv2f> <rect width="32" height="32" rx="8" fill="#3B82F6" data-astro-cid-ssfzsv2f></rect> <path d="M16 8L24 12V20L16 24L8 20V12L16 8Z" stroke="white" stroke-width="2" fill="none" data-astro-cid-ssfzsv2f></path> <circle cx="16" cy="16" r="3" fill="white" data-astro-cid-ssfzsv2f></circle> </svg> <span class="logo-text" data-astro-cid-ssfzsv2f>Control de Producción</span> </div> </div> <nav class="sidebar-nav" data-astro-cid-ssfzsv2f> <ul class="nav-list" data-astro-cid-ssfzsv2f> <li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/obras" class="nav-link " data-section="obras" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f> <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" data-astro-cid-ssfzsv2f></path> </svg>        </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Obras</span> </a> </li><li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/conjuntos" class="nav-link " data-section="conjuntos" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f>  <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" data-astro-cid-ssfzsv2f></path> </svg>       </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Conjuntos</span> </a> </li><li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/piezas" class="nav-link active" data-section="piezas" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f>   <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" data-astro-cid-ssfzsv2f></path> </svg>      </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Piezas</span> </a> </li><li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/chapas" class="nav-link " data-section="chapas" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f>    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" data-astro-cid-ssfzsv2f></path> </svg>     </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Chapas / Perfiles</span> </a> </li><li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/operarios" class="nav-link " data-section="operarios" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f>     <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m9 5.197v1M13 7a4 4 0 11-8 0 4 4 0 018 0z" data-astro-cid-ssfzsv2f></path> </svg>    </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Operarios</span> </a> </li><li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/accesos" class="nav-link " data-section="accesos" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f>      <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" data-astro-cid-ssfzsv2f></path> </svg>   </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Accesos</span> </a> </li><li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/trazabilidad" class="nav-link " data-section="trazabilidad" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f>       <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" data-astro-cid-ssfzsv2f></path> </svg>  </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Trazabilidad</span> </a> </li><li class="nav-item" data-astro-cid-ssfzsv2f> <a href="/admin/configuracion" class="nav-link " data-section="configuracion" data-astro-cid-ssfzsv2f> <div class="nav-icon" data-astro-cid-ssfzsv2f>        <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" data-astro-cid-ssfzsv2f></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" data-astro-cid-ssfzsv2f></path> </svg> </div> <span class="nav-text" data-astro-cid-ssfzsv2f>Configuración</span> </a> </li> </ul> </nav> <div class="sidebar-footer" data-astro-cid-ssfzsv2f> <div class="user-info" data-astro-cid-ssfzsv2f> <div class="user-avatar" data-astro-cid-ssfzsv2f> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" data-astro-cid-ssfzsv2f></path> </svg> </div> <div class="user-details" data-astro-cid-ssfzsv2f> <span class="user-name" data-astro-cid-ssfzsv2f>Admin User</span> <span class="user-role" data-astro-cid-ssfzsv2f>Administrador</span> </div> </div> <button class="logout-btn" title="Cerrar sesión" data-astro-cid-ssfzsv2f> <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-ssfzsv2f> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" data-astro-cid-ssfzsv2f></path> </svg> </button> </div> </aside>  <main class="main-content" data-astro-cid-2kanml4j> <div class="content-wrapper" data-astro-cid-2kanml4j>  <div class="page-header" data-astro-cid-wu5dj4rx> <div class="header-content" data-astro-cid-wu5dj4rx> <div class="header-text" data-astro-cid-wu5dj4rx> <h1 class="page-title" data-astro-cid-wu5dj4rx>Gestión de Piezas</h1> <p class="page-subtitle" data-astro-cid-wu5dj4rx>Control de inventario y seguimiento de piezas individuales</p> </div> <div class="header-actions" data-astro-cid-wu5dj4rx> <button class="action-button" onclick="openModal('modal-nueva-pieza')" data-astro-cid-wu5dj4rx> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-wu5dj4rx> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" data-astro-cid-wu5dj4rx></path> </svg> Nueva Pieza </button> </div> </div> </div>  <div class="piezas-section" data-astro-cid-vag3ingl> <div class="stats-grid" data-astro-cid-vag3ingl> <div class="stat-card" data-astro-cid-vag3ingl> <div class="stat-icon inventory" data-astro-cid-vag3ingl> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-vag3ingl> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" data-astro-cid-vag3ingl></path> </svg> </div> <div class="stat-content" data-astro-cid-vag3ingl> <div class="stat-number" data-astro-cid-vag3ingl>3</div> <div class="stat-label" data-astro-cid-vag3ingl>Total Piezas</div> </div> </div> <div class="stat-card" data-astro-cid-vag3ingl> <div class="stat-icon fabrication" data-astro-cid-vag3ingl> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-vag3ingl> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4" data-astro-cid-vag3ingl></path> </svg> </div> <div class="stat-content" data-astro-cid-vag3ingl> <div class="stat-number" data-astro-cid-vag3ingl>1</div> <div class="stat-label" data-astro-cid-vag3ingl>En Corte</div> </div> </div> <div class="stat-card" data-astro-cid-vag3ingl> <div class="stat-icon ready" data-astro-cid-vag3ingl> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-vag3ingl> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-vag3ingl></path> </svg> </div> <div class="stat-content" data-astro-cid-vag3ingl> <div class="stat-number" data-astro-cid-vag3ingl>0</div> <div class="stat-label" data-astro-cid-vag3ingl>En Soldadura</div> </div> </div> <div class="stat-card" data-astro-cid-vag3ingl> <div class="stat-icon quality" data-astro-cid-vag3ingl> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-vag3ingl> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" data-astro-cid-vag3ingl></path> </svg> </div> <div class="stat-content" data-astro-cid-vag3ingl> <div class="stat-number" data-astro-cid-vag3ingl>0</div> <div class="stat-label" data-astro-cid-vag3ingl>En Montaje</div> </div> </div> </div> <div class="piezas-table" data-astro-cid-vag3ingl> <div class="table-header" data-astro-cid-vag3ingl> <h3 data-astro-cid-vag3ingl>Piezas Registradas</h3> <div class="table-filters" data-astro-cid-vag3ingl> <select class="filter-select" id="fase-filter" data-astro-cid-vag3ingl> <option value="" data-astro-cid-vag3ingl>Todas las fases</option> <option value="0" data-astro-cid-vag3ingl>Corte</option> <option value="1" data-astro-cid-vag3ingl>Biselado</option> <option value="2" data-astro-cid-vag3ingl>Montaje</option> <option value="3" data-astro-cid-vag3ingl>Soldadura</option> </select> <input type="text" class="filter-input" id="search-input" placeholder="Buscar por código o colada..." data-astro-cid-vag3ingl> <button class="btn-import" onclick="openModal('modal-import-csv')" data-astro-cid-vag3ingl> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-vag3ingl> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-astro-cid-vag3ingl></path> </svg>
Importar CSV
</button> </div> </div> <div class="table-container" data-astro-cid-aaagcoq6> <table class="data-table" data-astro-cid-aaagcoq6> <thead data-astro-cid-aaagcoq6> <tr data-astro-cid-aaagcoq6> <th data-astro-cid-aaagcoq6>Código</th> <th data-astro-cid-aaagcoq6>Tipo Material</th> <th data-astro-cid-aaagcoq6>Fase</th> <th data-astro-cid-aaagcoq6>Conjunto</th> <th data-astro-cid-aaagcoq6>Chapa</th> <th data-astro-cid-aaagcoq6>Colada</th> <th data-astro-cid-aaagcoq6>Fecha Creación</th> <th data-astro-cid-aaagcoq6>Acciones</th> </tr> </thead> <tbody data-astro-cid-aaagcoq6> <tr data-astro-cid-aaagcoq6> <td data-astro-cid-aaagcoq6> <div class="pieza-info" data-astro-cid-aaagcoq6> <strong data-astro-cid-aaagcoq6>pl-44</strong> <span class="pieza-id" data-astro-cid-aaagcoq6>ID: 3</span> </div> </td> <td data-astro-cid-aaagcoq6> <span class="material-badge" data-astro-cid-aaagcoq6> chapas y perfiles </span> </td> <td data-astro-cid-aaagcoq6> <span class="fase-badge fase-0" data-astro-cid-aaagcoq6> Corte </span> </td> <td data-astro-cid-aaagcoq6> <div class="conjunto-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>12345</span> </div> </td> <td data-astro-cid-aaagcoq6> <div class="chapa-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>#1234</span> </div> </td> <td data-astro-cid-aaagcoq6> <div class="colada-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>asdf</span> </div> </td> <td data-astro-cid-aaagcoq6>30/7/2025</td> <td data-astro-cid-aaagcoq6> <div class="action-buttons" data-astro-cid-aaagcoq6> <button class="btn-icon" title="Ver detalles" onclick="openModal('detail-pieza-3')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" data-astro-cid-aaagcoq6></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" data-astro-cid-aaagcoq6></path> </svg> </button> <button class="btn-icon" title="Editar" onclick="editPieza('3')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-aaagcoq6></path> </svg> </button> <button class="btn-icon btn-delete" title="Eliminar" onclick="deletePieza('3', 'pl-44')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" data-astro-cid-aaagcoq6></path> </svg> </button> </div> </td> </tr><tr data-astro-cid-aaagcoq6> <td data-astro-cid-aaagcoq6> <div class="pieza-info" data-astro-cid-aaagcoq6> <strong data-astro-cid-aaagcoq6>PL-10</strong> <span class="pieza-id" data-astro-cid-aaagcoq6>ID: 2</span> </div> </td> <td data-astro-cid-aaagcoq6> <span class="material-badge" data-astro-cid-aaagcoq6> chapas y perfiles </span> </td> <td data-astro-cid-aaagcoq6> <span class="fase-badge fase-1" data-astro-cid-aaagcoq6> Biselado </span> </td> <td data-astro-cid-aaagcoq6> <div class="conjunto-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>12345</span> </div> </td> <td data-astro-cid-aaagcoq6> <div class="chapa-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>#3</span> </div> </td> <td data-astro-cid-aaagcoq6> <div class="colada-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>COL-56</span> </div> </td> <td data-astro-cid-aaagcoq6>30/7/2025</td> <td data-astro-cid-aaagcoq6> <div class="action-buttons" data-astro-cid-aaagcoq6> <button class="btn-icon" title="Ver detalles" onclick="openModal('detail-pieza-2')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" data-astro-cid-aaagcoq6></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" data-astro-cid-aaagcoq6></path> </svg> </button> <button class="btn-icon" title="Editar" onclick="editPieza('2')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-aaagcoq6></path> </svg> </button> <button class="btn-icon btn-delete" title="Eliminar" onclick="deletePieza('2', 'PL-10')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" data-astro-cid-aaagcoq6></path> </svg> </button> </div> </td> </tr><tr data-astro-cid-aaagcoq6> <td data-astro-cid-aaagcoq6> <div class="pieza-info" data-astro-cid-aaagcoq6> <strong data-astro-cid-aaagcoq6>1234</strong> <span class="pieza-id" data-astro-cid-aaagcoq6>ID: 1</span> </div> </td> <td data-astro-cid-aaagcoq6> <span class="material-badge" data-astro-cid-aaagcoq6> - </span> </td> <td data-astro-cid-aaagcoq6> <span class="fase-badge fase-1" data-astro-cid-aaagcoq6> Biselado </span> </td> <td data-astro-cid-aaagcoq6> <div class="conjunto-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>12345</span> </div> </td> <td data-astro-cid-aaagcoq6> <div class="chapa-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>#1234</span> </div> </td> <td data-astro-cid-aaagcoq6> <div class="colada-info" data-astro-cid-aaagcoq6> <span data-astro-cid-aaagcoq6>-</span> </div> </td> <td data-astro-cid-aaagcoq6>24/7/2025</td> <td data-astro-cid-aaagcoq6> <div class="action-buttons" data-astro-cid-aaagcoq6> <button class="btn-icon" title="Ver detalles" onclick="openModal('detail-pieza-1')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" data-astro-cid-aaagcoq6></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" data-astro-cid-aaagcoq6></path> </svg> </button> <button class="btn-icon" title="Editar" onclick="editPieza('1')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-aaagcoq6></path> </svg> </button> <button class="btn-icon btn-delete" title="Eliminar" onclick="deletePieza('1', '1234')" data-astro-cid-aaagcoq6> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-aaagcoq6> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" data-astro-cid-aaagcoq6></path> </svg> </button> </div> </td> </tr> </tbody> </table> </div>  <script type="module">
  // Función para editar pieza
  window.editPieza = async function(piezaId) {
    try {
      const response = await fetch(`/api/piezas/${piezaId}`);
      const result = await response.json();
      
      if (result.success) {
        const pieza = result.data;
        
        // Llenar el formulario con los datos existentes
        const form = document.getElementById('piezas-form');
        if (form) {
          form.querySelector('[name="codigo"]').value = pieza.codigo || '';
          form.querySelector('[name="tipo_material"]').value = pieza.tipo_material || '';
          form.querySelector('[name="colada"]').value = pieza.colada || '';
          form.querySelector('[name="fase"]').value = pieza.fase?.toString() || '';
          form.querySelector('[name="conjunto_id"]').value = pieza.conjunto_id?.toString() || '';
          form.querySelector('[name="chapa_id"]').value = pieza.chapa_id?.toString() || '';
          
          // Cambiar el comportamiento del formulario para actualizar
          form.setAttribute('data-edit-id', piezaId);
          form.querySelector('.btn-submit').innerHTML = `
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Actualizar Pieza
          `;
          
          // Cambiar el título del modal
          const modal = document.getElementById('modal-nueva-pieza');
          const title = modal.querySelector('.modal-title');
          if (title) {
            title.textContent = 'Editar Pieza';
          }
          
          // Abrir el modal
          openModal('modal-nueva-pieza');
        }
      }
    } catch (error) {
      console.error('Error al cargar pieza para editar:', error);
      alert('Error al cargar los datos de la pieza');
    }
  };

  // Función para eliminar pieza
  window.deletePieza = async function(piezaId, piezaCodigo) {
    if (confirm(`¿Estás seguro de que quieres eliminar la pieza "${piezaCodigo}"? Esta acción no se puede deshacer.`)) {
      try {
        const response = await fetch(`/api/piezas/${piezaId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('Pieza eliminada correctamente');
          location.reload();
        } else {
          throw new Error(result.error || 'Error al eliminar la pieza');
        }
      } catch (error) {
        console.error('Error al eliminar pieza:', error);
        alert('Error al eliminar la pieza: ' + error.message);
      }
    }
  };

  // Modificar el comportamiento del formulario para manejar edición
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('piezas-form');
    if (form) {
      // Remover event listeners existentes para evitar duplicados
      const newForm = form.cloneNode(true);
      form.parentNode.replaceChild(newForm, form);
      
      newForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const editId = newForm.getAttribute('data-edit-id');
        const isEditing = !!editId;
        
        const formData = new FormData(newForm);
        const submitButton = newForm.querySelector('.btn-submit');
        
        // Prevenir múltiples envíos
        if (submitButton.disabled) {
          return;
        }
        
        // Deshabilitar botón durante el envío
        submitButton.disabled = true;
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = `
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="animate-spin">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          ${isEditing ? 'Actualizando...' : 'Creando...'}
        `;

        const body = {
          codigo: formData.get('codigo'),
          tipo_material: formData.get('tipo_material'),
          colada: formData.get('colada'),
          fase: formData.get('fase'),
          conjunto_id: formData.get('conjunto_id'),
          chapa_id: formData.get('chapa_id'),
        };

        try {
          const url = isEditing ? `/api/piezas/${editId}` : '/api/piezas/create';
          const method = isEditing ? 'PUT' : 'POST';
          
          const res = await fetch(url, {
            method: method,
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          });

          const json = await res.json();
          
          if (json.success) {
            // Mostrar éxito
            submitButton.innerHTML = `
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              ${isEditing ? '¡Pieza actualizada!' : '¡Pieza creada!'}
            `;
            submitButton.style.background = '#10b981';
            
            // Recargar la página después de un breve delay
            setTimeout(() => {
              location.reload();
            }, 1500);
          } else {
            throw new Error(json.error || `Error al ${isEditing ? 'actualizar' : 'crear'} la pieza`);
          }
        } catch (error) {
          console.error(`Error al ${isEditing ? 'actualizar' : 'crear'} pieza:`, error);
          
          // Mostrar error
          submitButton.innerHTML = `
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
            Error al ${isEditing ? 'actualizar' : 'crear'}
          `;
          submitButton.style.background = '#ef4444';
          
          // Restaurar botón después de un delay
          setTimeout(() => {
            submitButton.innerHTML = originalText;
            submitButton.style.background = '';
            submitButton.disabled = false;
          }, 2000);
        }
      });
    }
  });

  // Limpiar formulario cuando se cierra el modal
  document.addEventListener('click', function(e) {
    if (e.target.matches('[data-close-modal="modal-nueva-pieza"]')) {
      const form = document.getElementById('piezas-form');
      if (form) {
        form.reset();
        form.removeAttribute('data-edit-id');
        form.querySelector('.btn-submit').innerHTML = `
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Crear Pieza
        `;
        
        // Restaurar título del modal
        const modal = document.getElementById('modal-nueva-pieza');
        const title = modal.querySelector('.modal-title');
        if (title) {
          title.textContent = 'Nueva Pieza';
        }
      }
    }
  });
</script> </div> </div> <!-- Modal para Nueva Pieza --> <div id="modal-nueva-pieza" class="modal modal-lg" data-astro-cid-qmzm2soj> <div class="modal-backdrop" data-astro-cid-qmzm2soj></div> <div class="modal-container" data-astro-cid-qmzm2soj> <div class="modal-header" data-astro-cid-qmzm2soj> <h2 class="modal-title" data-astro-cid-qmzm2soj>Nueva Pieza</h2> <button class="modal-close" data-close-modal="modal-nueva-pieza" data-astro-cid-qmzm2soj> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-qmzm2soj> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-astro-cid-qmzm2soj></path> </svg> </button> </div> <div class="modal-body" data-astro-cid-qmzm2soj>  <form class="piezas-form" id="piezas-form" data-astro-cid-sigyfebt> <div class="form-grid" data-astro-cid-sigyfebt> <div class="form-column" data-astro-cid-sigyfebt> <div class="form-field" data-astro-cid-nn45c2qd> <label class="form-label" for="codigo" data-astro-cid-nn45c2qd> Código de la Pieza <span class="required" data-astro-cid-nn45c2qd>*</span> </label> <input class="form-input" type="text" name="codigo" id="codigo" placeholder="Ej: PZ-001" value required data-astro-cid-nn45c2qd>  </div>  <div class="form-field" data-astro-cid-nn45c2qd> <label class="form-label" for="tipo_material" data-astro-cid-nn45c2qd> Tipo de Material <span class="required" data-astro-cid-nn45c2qd>*</span> </label> <select class="form-input" name="tipo_material" id="tipo_material" required data-astro-cid-nn45c2qd> <option value="" data-astro-cid-nn45c2qd>Seleccionar...</option> <option value="chapas y perfiles" data-astro-cid-nn45c2qd> Chapas y Perfiles </option> </select>  </div>  <div class="form-field" data-astro-cid-nn45c2qd> <label class="form-label" for="colada" data-astro-cid-nn45c2qd> Colada  </label> <input class="form-input" type="text" name="colada" id="colada" placeholder="Ej: COL2024001" value data-astro-cid-nn45c2qd>  </div>  </div> <div class="form-column" data-astro-cid-sigyfebt> <div class="form-field" data-astro-cid-nn45c2qd> <label class="form-label" for="fase" data-astro-cid-nn45c2qd> Fase <span class="required" data-astro-cid-nn45c2qd>*</span> </label> <select class="form-input" name="fase" id="fase" required data-astro-cid-nn45c2qd> <option value="" data-astro-cid-nn45c2qd>Seleccionar...</option> <option value="0" data-astro-cid-nn45c2qd> Corte </option><option value="1" data-astro-cid-nn45c2qd> Biselado </option><option value="2" data-astro-cid-nn45c2qd> Montaje </option><option value="3" data-astro-cid-nn45c2qd> Soldadura </option> </select>  </div>  <div class="form-field" data-astro-cid-nn45c2qd> <label class="form-label" for="conjunto_id" data-astro-cid-nn45c2qd> Conjunto  </label> <select class="form-input" name="conjunto_id" id="conjunto_id" data-astro-cid-nn45c2qd> <option value="" data-astro-cid-nn45c2qd>Seleccionar...</option> <option value="1" data-astro-cid-nn45c2qd> 12345 </option><option value="3" data-astro-cid-nn45c2qd> PL-10 </option> </select>  </div>  <div class="form-field" data-astro-cid-nn45c2qd> <label class="form-label" for="chapa_id" data-astro-cid-nn45c2qd> Chapa  </label> <select class="form-input" name="chapa_id" id="chapa_id" data-astro-cid-nn45c2qd> <option value="" data-astro-cid-nn45c2qd>Seleccionar...</option> <option value="2" data-astro-cid-nn45c2qd> #3 </option><option value="3" data-astro-cid-nn45c2qd> #3 </option><option value="1" data-astro-cid-nn45c2qd> #1234 </option> </select>  </div>  </div> </div> <div class="form-actions" data-astro-cid-sigyfebt> <button type="button" class="btn-cancel" data-close-modal="modal-nueva-pieza" data-astro-cid-sigyfebt>
Cancelar
</button> <button type="submit" class="btn-submit" data-astro-cid-sigyfebt> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-sigyfebt> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-astro-cid-sigyfebt></path> </svg>
Crear Pieza
</button> </div> </form>  <script type="module">
  document.getElementById('piezas-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);
    const submitButton = form.querySelector('.btn-submit');
    
    // Prevenir múltiples envíos
    if (submitButton.disabled) {
      return;
    }
    
    // Deshabilitar botón durante el envío
    submitButton.disabled = true;
    const originalText = submitButton.innerHTML;
    submitButton.innerHTML = `
      <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="animate-spin">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
      Creando...
    `;

    const body = {
      codigo: formData.get('codigo'),
      tipo_material: formData.get('tipo_material'),
      colada: formData.get('colada'),
      fase: formData.get('fase'),
      conjunto_id: formData.get('conjunto_id'),
      chapa_id: formData.get('chapa_id'),
    };

    try {
      const res = await fetch('/api/piezas/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });

      const json = await res.json();
      
      if (json.success) {
        // Mostrar éxito
        submitButton.innerHTML = `
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          ¡Pieza creada!
        `;
        submitButton.style.background = '#10b981';
        
        // Recargar la página después de un breve delay
        setTimeout(() => {
          location.reload();
        }, 1500);
      } else {
        throw new Error(json.error || 'Error al crear la pieza');
      }
    } catch (error) {
      console.error('Error al crear pieza:', error);
      
      // Mostrar error
      submitButton.innerHTML = `
        <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        Error al crear
      `;
      submitButton.style.background = '#ef4444';
      
      // Restaurar botón después de un delay
      setTimeout(() => {
        submitButton.innerHTML = originalText;
        submitButton.style.background = '';
        submitButton.disabled = false;
      }, 2000);
    }
  });
</script>  </div> </div> </div>  <!-- Modal para Importar CSV --> <div id="modal-import-csv" class="modal modal-lg" data-astro-cid-qmzm2soj> <div class="modal-backdrop" data-astro-cid-qmzm2soj></div> <div class="modal-container" data-astro-cid-qmzm2soj> <div class="modal-header" data-astro-cid-qmzm2soj> <h2 class="modal-title" data-astro-cid-qmzm2soj>Importar Piezas desde CSV</h2> <button class="modal-close" data-close-modal="modal-import-csv" data-astro-cid-qmzm2soj> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-qmzm2soj> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-astro-cid-qmzm2soj></path> </svg> </button> </div> <div class="modal-body" data-astro-cid-qmzm2soj>  <div class="import-csv-form" data-astro-cid-vag3ingl> <div class="csv-instructions" data-astro-cid-vag3ingl> <h4 data-astro-cid-vag3ingl>Formato del archivo CSV</h4> <p data-astro-cid-vag3ingl>El archivo debe contener las siguientes columnas:</p> <ul data-astro-cid-vag3ingl> <li data-astro-cid-vag3ingl><strong data-astro-cid-vag3ingl>codigo</strong> - Código único de la pieza (obligatorio)</li> <li data-astro-cid-vag3ingl><strong data-astro-cid-vag3ingl>tipo_material</strong> - Tipo de material (opcional, por defecto: "chapas y perfiles")</li> <li data-astro-cid-vag3ingl><strong data-astro-cid-vag3ingl>colada</strong> - Código de colada (opcional)</li> <li data-astro-cid-vag3ingl><strong data-astro-cid-vag3ingl>fase</strong> - Fase: 0=Corte, 1=Biselado, 2=Montaje, 3=Soldadura (opcional, por defecto: 0)</li> <li data-astro-cid-vag3ingl><strong data-astro-cid-vag3ingl>conjunto_id</strong> - ID del conjunto (opcional)</li> <li data-astro-cid-vag3ingl><strong data-astro-cid-vag3ingl>chapa_id</strong> - ID de la chapa (opcional)</li> </ul> </div> <div class="csv-upload" data-astro-cid-vag3ingl> <input type="file" id="csv-file" accept=".csv" data-astro-cid-vag3ingl> <div class="upload-area" id="upload-area" data-astro-cid-vag3ingl> <svg width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-vag3ingl> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-astro-cid-vag3ingl></path> </svg> <p data-astro-cid-vag3ingl>Arrastra tu archivo CSV aquí o haz clic para seleccionar</p> </div> </div> <div class="csv-preview" id="csv-preview" style="display: none;" data-astro-cid-vag3ingl> <h4 data-astro-cid-vag3ingl>Vista previa del archivo</h4> <div class="preview-table" id="preview-table" data-astro-cid-vag3ingl></div> </div> <div class="form-actions" data-astro-cid-vag3ingl> <button type="button" class="btn-cancel" data-close-modal="modal-import-csv" data-astro-cid-vag3ingl>
Cancelar
</button> <button type="button" class="btn-submit" id="import-btn" disabled data-astro-cid-vag3ingl> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-vag3ingl> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" data-astro-cid-vag3ingl></path> </svg>
Importar Piezas
</button> </div> </div>  </div> </div> </div>  <!-- Modales de Detalles dinámicos --> <div id="detail-pieza-3" class="modal modal-xl detail-modal" data-astro-cid-bit2iklq> <div class="modal-backdrop" data-astro-cid-bit2iklq></div> <div class="modal-container" data-astro-cid-bit2iklq> <div class="modal-header" data-astro-cid-bit2iklq> <h2 class="modal-title" data-astro-cid-bit2iklq>Pieza pl-44</h2> <div class="header-actions" data-astro-cid-bit2iklq> <button class="btn-edit" data-edit-mode="toggle" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-bit2iklq></path> </svg>
Editar
</button> <button class="modal-close" data-close-modal="detail-pieza-3" data-astro-cid-bit2iklq> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-astro-cid-bit2iklq></path> </svg> </button> </div> </div> <div class="modal-body" data-astro-cid-bit2iklq> <div class="detail-tabs" data-astro-cid-bit2iklq> <button class="tab-button active" data-tab="general" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-bit2iklq></path> </svg>
General
</button> <button class="tab-button" data-tab="progress" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" data-astro-cid-bit2iklq></path> </svg>
Progreso
</button> <button class="tab-button" data-tab="history" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-bit2iklq></path> </svg>
Historial
</button> <button class="tab-button" data-tab="files" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-astro-cid-bit2iklq></path> </svg>
Archivos
</button> </div> <div class="tab-content" data-astro-cid-bit2iklq> <div class="tab-panel active" data-panel="general" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="progress" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="history" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="files" data-astro-cid-bit2iklq>  </div> </div> </div> <div class="modal-footer" data-astro-cid-bit2iklq> <div class="footer-actions view-mode" data-astro-cid-bit2iklq> <button class="btn-secondary" data-close-modal="detail-pieza-3" data-astro-cid-bit2iklq>Cerrar</button> <button class="btn-primary" data-edit-mode="enable" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-bit2iklq></path> </svg>
Editar
</button> </div> <div class="footer-actions edit-mode" style="display: none;" data-astro-cid-bit2iklq> <button class="btn-secondary" data-edit-mode="cancel" data-astro-cid-bit2iklq>Cancelar</button> <button class="btn-primary" data-edit-mode="save" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-astro-cid-bit2iklq></path> </svg>
Guardar Cambios
</button> </div> </div> </div> </div> <div id="detail-pieza-2" class="modal modal-xl detail-modal" data-astro-cid-bit2iklq> <div class="modal-backdrop" data-astro-cid-bit2iklq></div> <div class="modal-container" data-astro-cid-bit2iklq> <div class="modal-header" data-astro-cid-bit2iklq> <h2 class="modal-title" data-astro-cid-bit2iklq>Pieza PL-10</h2> <div class="header-actions" data-astro-cid-bit2iklq> <button class="btn-edit" data-edit-mode="toggle" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-bit2iklq></path> </svg>
Editar
</button> <button class="modal-close" data-close-modal="detail-pieza-2" data-astro-cid-bit2iklq> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-astro-cid-bit2iklq></path> </svg> </button> </div> </div> <div class="modal-body" data-astro-cid-bit2iklq> <div class="detail-tabs" data-astro-cid-bit2iklq> <button class="tab-button active" data-tab="general" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-bit2iklq></path> </svg>
General
</button> <button class="tab-button" data-tab="progress" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" data-astro-cid-bit2iklq></path> </svg>
Progreso
</button> <button class="tab-button" data-tab="history" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-bit2iklq></path> </svg>
Historial
</button> <button class="tab-button" data-tab="files" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-astro-cid-bit2iklq></path> </svg>
Archivos
</button> </div> <div class="tab-content" data-astro-cid-bit2iklq> <div class="tab-panel active" data-panel="general" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="progress" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="history" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="files" data-astro-cid-bit2iklq>  </div> </div> </div> <div class="modal-footer" data-astro-cid-bit2iklq> <div class="footer-actions view-mode" data-astro-cid-bit2iklq> <button class="btn-secondary" data-close-modal="detail-pieza-2" data-astro-cid-bit2iklq>Cerrar</button> <button class="btn-primary" data-edit-mode="enable" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-bit2iklq></path> </svg>
Editar
</button> </div> <div class="footer-actions edit-mode" style="display: none;" data-astro-cid-bit2iklq> <button class="btn-secondary" data-edit-mode="cancel" data-astro-cid-bit2iklq>Cancelar</button> <button class="btn-primary" data-edit-mode="save" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-astro-cid-bit2iklq></path> </svg>
Guardar Cambios
</button> </div> </div> </div> </div> <div id="detail-pieza-1" class="modal modal-xl detail-modal" data-astro-cid-bit2iklq> <div class="modal-backdrop" data-astro-cid-bit2iklq></div> <div class="modal-container" data-astro-cid-bit2iklq> <div class="modal-header" data-astro-cid-bit2iklq> <h2 class="modal-title" data-astro-cid-bit2iklq>Pieza 1234</h2> <div class="header-actions" data-astro-cid-bit2iklq> <button class="btn-edit" data-edit-mode="toggle" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-bit2iklq></path> </svg>
Editar
</button> <button class="modal-close" data-close-modal="detail-pieza-1" data-astro-cid-bit2iklq> <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-astro-cid-bit2iklq></path> </svg> </button> </div> </div> <div class="modal-body" data-astro-cid-bit2iklq> <div class="detail-tabs" data-astro-cid-bit2iklq> <button class="tab-button active" data-tab="general" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-bit2iklq></path> </svg>
General
</button> <button class="tab-button" data-tab="progress" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" data-astro-cid-bit2iklq></path> </svg>
Progreso
</button> <button class="tab-button" data-tab="history" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" data-astro-cid-bit2iklq></path> </svg>
Historial
</button> <button class="tab-button" data-tab="files" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-astro-cid-bit2iklq></path> </svg>
Archivos
</button> </div> <div class="tab-content" data-astro-cid-bit2iklq> <div class="tab-panel active" data-panel="general" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="progress" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="history" data-astro-cid-bit2iklq>  </div> <div class="tab-panel" data-panel="files" data-astro-cid-bit2iklq>  </div> </div> </div> <div class="modal-footer" data-astro-cid-bit2iklq> <div class="footer-actions view-mode" data-astro-cid-bit2iklq> <button class="btn-secondary" data-close-modal="detail-pieza-1" data-astro-cid-bit2iklq>Cerrar</button> <button class="btn-primary" data-edit-mode="enable" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" data-astro-cid-bit2iklq></path> </svg>
Editar
</button> </div> <div class="footer-actions edit-mode" style="display: none;" data-astro-cid-bit2iklq> <button class="btn-secondary" data-edit-mode="cancel" data-astro-cid-bit2iklq>Cancelar</button> <button class="btn-primary" data-edit-mode="save" data-astro-cid-bit2iklq> <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-astro-cid-bit2iklq> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-astro-cid-bit2iklq></path> </svg>
Guardar Cambios
</button> </div> </div> </div> </div>   <script type="module">
  // Filtros en tiempo real
  document.addEventListener('DOMContentLoaded', function() {
    const faseFilter = document.getElementById('fase-filter');
    const searchInput = document.getElementById('search-input');
    const tableRows = document.querySelectorAll('.data-table tbody tr');

    function filterTable() {
      const faseValue = faseFilter.value;
      const searchValue = searchInput.value.toLowerCase();

      tableRows.forEach(row => {
        const fase = row.querySelector('.fase-badge').className;
        const codigo = row.cells[0].textContent.toLowerCase();
        const colada = row.cells[5].textContent.toLowerCase();

        const matchesFase = !faseValue || fase.includes(`fase-${faseValue}`);
        const matchesSearch = !searchValue || 
          codigo.includes(searchValue) || 
          colada.includes(searchValue);

        if (matchesFase && matchesSearch) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    faseFilter.addEventListener('change', filterTable);
    searchInput.addEventListener('input', filterTable);

    // Funcionalidad de importación CSV
    const csvFile = document.getElementById('csv-file');
    const uploadArea = document.getElementById('upload-area');
    const csvPreview = document.getElementById('csv-preview');
    const previewTable = document.getElementById('preview-table');
    const importBtn = document.getElementById('import-btn');
    let csvData = null;

    // Click en área de upload
    uploadArea.addEventListener('click', () => csvFile.click());

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFile(files[0]);
      }
    });

    // Selección de archivo
    csvFile.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFile(e.target.files[0]);
      }
    });

    function handleFile(file) {
      if (!file.name.endsWith('.csv')) {
        alert('Por favor selecciona un archivo CSV válido');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const csv = e.target.result;
        parseCSV(csv);
      };
      reader.readAsText(file);
    }

    function parseCSV(csv) {
      const lines = csv.split('\n').filter(line => line.trim());
      if (lines.length < 2) {
        alert('El archivo CSV debe tener al menos una fila de encabezados y una fila de datos');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim());
      const rows = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] || '';
        });
        return row;
      });

      csvData = rows;
      showPreview(headers, rows);
      importBtn.disabled = false;
    }

    function showPreview(headers, rows) {
      let html = '<table class="preview-data-table"><thead><tr>';
      headers.forEach(header => {
        html += `<th>${header}</th>`;
      });
      html += '</tr></thead><tbody>';

      rows.slice(0, 5).forEach(row => {
        html += '<tr>';
        headers.forEach(header => {
          html += `<td>${row[header] || '-'}</td>`;
        });
        html += '</tr>';
      });

      if (rows.length > 5) {
        html += `<tr><td colspan="${headers.length}" style="text-align: center; font-style: italic;">... y ${rows.length - 5} filas más</td></tr>`;
      }

      html += '</tbody></table>';
      previewTable.innerHTML = html;
      csvPreview.style.display = 'block';
    }

    // Importar CSV
    importBtn.addEventListener('click', async () => {
      if (!csvData) return;

      importBtn.disabled = true;
      const originalText = importBtn.innerHTML;
      importBtn.innerHTML = `
        <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="animate-spin">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        Importando...
      `;

      try {
        const response = await fetch('/api/piezas/import-csv', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ csvData })
        });

        const result = await response.json();

        if (result.success) {
          importBtn.innerHTML = `
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            ¡Importado!
          `;
          importBtn.style.background = '#10b981';
          
          alert(result.message);
          
          setTimeout(() => {
            location.reload();
          }, 1500);
        } else {
          throw new Error(result.error || 'Error al importar CSV');
        }
      } catch (error) {
        console.error('Error al importar CSV:', error);
        alert('Error al importar CSV: ' + error.message);
        
        importBtn.innerHTML = originalText;
        importBtn.disabled = false;
      }
    });
  });
</script>  </div> </main> </div> <script type="module" src="/_astro/AdminLayout.astro_astro_type_script_index_0_lang.BjVjCbzL.js"></script> </body> </html> 